# The Diamond Price Predictor

## Description
The Diamond Price Prediction project aims to build a machine learning model that accurately estimates the price of a diamond based on its attributes such as carat, cut, color, clarity, depth, and dimensions. The project will involve data collection, preprocessing, feature engineering, model training, and deployment through a Streamlit web application.

## Project Structure

| Folder Name   | Description                                                                |
|---------------|----------------------------------------------------------------------------|
| api           | Contains FASTAPI code that host final machine learning model as rest api   |
| config        | Contains Configurable application settings used in this project            |
| data          | Contains dataset used to train and test machine learning models explored   |
| data_analysis | Contains code to visualize relationships between attributes                |
| docs          | Image repository for visualizations generated by data_analysis code        |
| dpputility    | Custom Package that contains re-usable code used across this project       |
| frontend      | Streamlit application the enables end users to try out this model          |
| models        | Code for training,testing,tuning & metrics evaluation of regression models |

## Installation
* If you are looking to install and run, all applications and modules then perform below steps. Please note if you bypass below steps dpputility package may not be installed correctly.
  * Open command prompt and change the current working directory to SDS-CP023-diamond-price-predictor\submissions-team\pavan-kumar-reddy-kathi
  * Once you are in pavan-kumar-reddy-kathi directory, run **pip install -r requirements.txt**
* Streamlit application requires Fastapi to be up and running inorder to be functional.
* For FastAPI deployment run **uvicorn diamond_price_prediction_api:app --reload** command (after changing current working directory to **api** folder)
* Update .env entry (**PREDICTION_API_URL**) in Streamlit app to point to FastAPI url (http://127.0.0.1:8000)
* For Streamlit application deployment run **streamlit run app.py** command (after changing current working directory to **frontend** folder)
* You can also only run FASTAPI, Streamlit applications individually, by only installing required dependencies from requirements.txt file under respective folders(api,frontend)

## Dataset
Source to Dataset: https://www.kaggle.com/datasets/willianoliveiragibin/type-of-the-diamond

| Column Name   | Description                                                                                             |
|---------------|---------------------------------------------------------------------------------------------------------|
| cut           | Determines Diamond's shine with categories as ideal, premium. good, very good and fair                  |
| color         | Color value ranges from D to J affecting the visual appeal of the diamond                               |
| clarity       | Describes the internal purity of the diamond with classifications like SI2 SI1 VS1 VS2 VVS2 VVS1 and I1 |
| carat         | Indicates the weight of the diamond                                                                     |
| depth         | Represents the diamondâ€™s depth percentage                                                               |
| table         | Refers to the flat facet on its surface, which is the large flat area visible from above                |
| price         | Cost of the diamond in USD                                                                              |
| x (Premium)   | Represents the width of the diamond                                                                     |
| z (Very Good) | Represents the height of the diamond                                                                    |
| y (Good)      | Represents the length of the diamond                                                                    |

* Though there is no missing(na/null/nan) data present in dataset, it is observed that there are few rows (around 20) with zero width, zero length, zero height. These rows are removed as these are just around 20 in count and there is no possibility of diamond being present  with zero value for width, length, height.
* An attempt is made to come up with derived feature Volume as multiplication of length, width and height of diamond, but that didn't result in improvement of model performance significantly.
* It is identified that there is not much linear relationship between dependent variables and target variable and hence not much weightage is given to linear regression models.
* carat,price,x (Premium),z (Very Good),y (Good) columns are highly correlated with each other. Refer correlation plots under **docs** folder.  
* Though outliers are observed, no attempt is made either to cap them or remove them, as there is no business knowledge around these outliers to find whether these are genuine or entered by mistake/error entry

| Attribute | Number of Outliers | Percentage | Skew  |
|-----------|--------------------|------------|-------|
| price     | 3532               | 6.55       | 1.62  |
| carat     | 1883               | 3.49       | 1.12  |
| depth     | 2543               | 4.72       | -0.08 |
| table     | 604                | 1.12       | 0.8   |
| width     | 24                 | 0.04       | 0.4   |
| height    | 29                 | 0.05       | 1.58  |
| length    | 22                 | 0.04       | 2.46  |

## Models
* 20% of dataset is used to test models
* Almost all available regression models are evaluated to identify how they are performing against dataset. R2 Score and RMSE metrics are calculated to evaluate models.Cross validation is performed for 10 splits and average R2 Score and RMSE metrics calculated for both test and train data to ensure better generalization of model. All these metrics are available as json files under Model\GridSearchCV\Untuned folder.
* Out of all evaluated models **CatBoost Regressor** outperformed other models with better R2 score and with minimal difference in RMSE between Train and Test data.
* Hyperparameter tuning is performed for top 2 (in terms of R2 score and RMSE metrics) regression models CatBoost & LightGBM by making use of **optuna**, unfortunately no further improvement in performance is observed for these two regression models.
* Tried out Artificial Neural Networks as well, but unfortunately unable to proceed further with cross validation as it was resulting in an error.

## Model Performance Metrics
| Regression Model      | R2_Test_Mean | R2_Train_Mean | RMSE_Test_Mean | RMSE_Train_Mean |
|-----------------------|--------------|---------------|----------------|-----------------|
| AdaBoostRegressor     | 0.9147       | 0.9159        | 1163.8         | 1156.18         |
| CatBoostRegressor     | 0.9829       | 0.9876        | 520.58         | 442.73          |
| DecisionTreeRegressor | 0.9657       | 0.9999        | 737.73         | 6.86            |
| ElasticNet            | 0.845        | 0.8453        | 1570.62        | 1569.65         |
| KNeighborsRegressor   | 0.9715       | 0.9999        | 673.24         | 6.78            |
| Lasso                 | 0.9012       | 0.9058        | 1251.09        | 1224.68         |
| LGBMRegressor         | 0.982        | 0.9864        | 533.19         | 465.03          |
| LinearRegression      | 0.9013       | 0.9058        | 1249.67        | 1224.65         |
| LinearSVR             | 0.8677       | 0.8677        | 1451.31        | 1451.43         |
| PolynomialFeatures    | 0.8947       | 0.9058        | 1282.81        | 1224.46         |
| RandomForestRegressor | 0.9815       | 0.9974        | 542.21         | 202.71          |
| Ridge                 | 0.9008       | 0.9058        | 1254.83        | 1224.67         |
| XGBRegressor          | 0.9812       | 0.9907        | 546.09         | 383.27          |

## Usage
* After setting up of FastAPI and StreamLit applications you can evaluate model performance by entering Diamond features and trying to predict Price for those input features.
* You can test FastAPI and StreamLit applications at below urls as well.
    * FastAPI-https://sds-cp023-diamond-price-predictor-bfar.onrender.com/docs
    * Streamlit App - https://sds-cp023-diamond-price-predictor-ui.onrender.com/

## Contact Information
https://www.linkedin.com/in/pavan-kumar-reddy-kathi-203563154/

